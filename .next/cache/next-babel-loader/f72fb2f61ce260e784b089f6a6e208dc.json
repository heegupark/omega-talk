{"ast":null,"code":"var __jsx = React.createElement;\nimport React, { useState, useEffect } from 'react';\nimport Window from '../components/window';\nimport socketIOClient from 'socket.io-client';\nconst socket = socketIOClient(`:${process.env.socketPort}/`);\nexport default function Main() {\n  const {\n    0: maxZIndex,\n    1: setMaxZIndex\n  } = useState(0);\n  const {\n    0: windows,\n    1: setWindows\n  } = useState([]);\n  const {\n    0: lastPosition,\n    1: setLastPosition\n  } = useState({\n    x: 200,\n    y: 50\n  });\n  const {\n    0: username,\n    1: setUsername\n  } = useState('');\n  useEffect(() => {\n    if (localStorage.getItem('omega-talk-username')) {\n      setUsername(localStorage.getItem('omega-talk-username'));\n    }\n  }, []);\n\n  const openWindow = (_id, room) => {\n    const isOpened = windows.findIndex(window => window._id === _id);\n    const newWindow = {\n      _id,\n      roomname: room.roomname,\n      positionX: lastPosition.x + 20,\n      positionY: lastPosition.y + 20,\n      zIndex: maxZIndex + 100,\n      owner: room.owner,\n      participants: room.participants.length\n    };\n\n    if (isOpened === -1) {\n      setWindows(windows => [...windows, newWindow]);\n      setLastPosition({\n        x: newWindow.positionX,\n        y: newWindow.positionY\n      });\n\n      if (socket) {\n        socket.emit('joinroom', {\n          _id,\n          username\n        });\n      }\n    } else {\n      const newWindows = windows.map(window => {\n        if (window._id === _id) {\n          window.zIndex = maxZIndex + 1;\n        }\n\n        return window;\n      });\n      setWindows(() => newWindows);\n    }\n  };\n\n  const closeWindow = _id => {\n    const newWindows = windows.filter(item => item._id !== _id);\n    setWindows(newWindows);\n  };\n\n  const signout = () => {\n    localStorage.removeItem('omega-talk-username');\n    setUsername('');\n  };\n\n  return __jsx(React.Fragment, null, username ? __jsx(React.Fragment, null, __jsx(Window, {\n    category: \"main\",\n    maxZIndex: maxZIndex,\n    username: username,\n    lastPosition: lastPosition,\n    setLastPosition: setLastPosition,\n    setMaxZIndex: setMaxZIndex,\n    openWindow: openWindow,\n    signout: signout\n  }), windows.map(window => {\n    return __jsx(Window, {\n      key: window._id,\n      window: window,\n      username: username,\n      zIndex: window.zIndex,\n      setLastPosition: setLastPosition,\n      maxZIndex: maxZIndex,\n      category: \"chat-room\",\n      closeWindow: closeWindow,\n      setMaxZIndex: setMaxZIndex\n    });\n  })) : __jsx(Window, {\n    setUsername: setUsername,\n    category: \"username\",\n    maxZIndex: maxZIndex,\n    setLastPosition: setLastPosition,\n    lastPosition: lastPosition,\n    setMaxZIndex: setMaxZIndex\n  }));\n}","map":null,"metadata":{},"sourceType":"module"}